package com.sist.databoard;

import com.sist.dao.*;

import java.io.File;
import java.util.StringTokenizer;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("board/")
public class DataBoardRestController {
	@Autowired
	private DataBoardDAO dao;
	
	// [글 수정] - AJAX 처리 
	@RequestMapping("update_ok.do")
	public String databoard_update_ok(DataBoardVO vo)
	{
		String result="";
		
		// 비밀번호 체크 
		String db_pwd=dao.databoardGetPassword(vo.getNo());
		if(db_pwd.equals(vo.getPwd()))
		{
			result="OK";
			dao.databoardUpdate(vo);
		}
		else
		{
			result="NOPWD";
		}
		return result;
	}
	
	// [글 삭제] - AJAX 처리  
	@RequestMapping("delete_ok.do")
	public String databoard_delete_ok(int no,String pwd)
	{
		String result="";
		DataBoardVO vo=dao.databoardFileInfoData(no);
		boolean bCheck=dao.databoardDelete(no, pwd);
		
		// 비번이 맞을 때 (DAO에서 이미 비번 체크)
		if(bCheck==true) // 파일 있음 
		{
			// 1. 게시글 삭제 - 비번 맞으면 DAO에서 삭제시킴  
			// 2. 파일 삭제 
			result="OK";
			try 
			{
				if(vo.getFilecount()>0) // 파일 개수가 0개 이상이면 
				{
					StringTokenizer st=new StringTokenizer(vo.getFilename(),",");
					while(st.hasMoreTokens())
					{
						File file=new File("c:\\upload\\"+st.nextToken());
						file.delete();
					}
				}
			} catch (Exception ex) {}
		}
		else
		{
			result="NOPWD";
		}
		
		return result;
	}
	
}










